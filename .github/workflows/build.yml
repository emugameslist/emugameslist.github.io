name: Static Site Pre-renderer and Deploy

# Define when this workflow should run:
on:
  # 1. On every push to the main branch
  push:
    branches: [ main ]
  # 2. Allow manual triggering from the GitHub Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest # Use the latest stable Ubuntu runner environment

    steps:
    - name: Checkout Code # Step 1: Clone the repository content
      uses: actions/checkout@v4
      
    - name: Set up Node.js # Step 2: Configure the Node.js environment required for build.js
      uses: actions/setup-node@v4
      with:
        node-version: '20' # Use a recent stable Node.js version
        
    - name: Install Dependencies # Step 3: Install the 'ini' package from package.json
      # This command installs all dependencies listed in your package.json
      run: npm install 

    - name: Run Static Generator Script # Step 4: Execute the static content generation script
      # This runs build.js, which creates all HTML files and sitemap.xml inside the 'pages' directory
      run: node build.js 

    - name: Deploy to GitHub Pages # Step 5: Publish the generated files
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        # The directory containing the final, generated files
        publish_dir: ./pages 
        # The target branch on GitHub Pages where the static files will be hosted
        publish_branch: gh-pages
        # Ensures that old, non-generated files are removed from the gh-pages branch
        keep_files: false
